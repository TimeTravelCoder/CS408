好的，这是关于“6.6 本章小结”的学习笔记：

**6.6 本章小结**

本章以MIPS指令系统中具有代表性的11条指令作为实现目标，详细介绍了单周期数据通路和多周期数据通路的设计过程以及相应的控制部件的设计。主要内容涵盖了CPU的主要功能和内部结构、指令的执行过程、数据通路的基本组成、数据通路的定时、数据通路中信息的流动过程、控制器的实现方式（硬连线路控制器和微程序控制器）以及异常和中断的概念。

**一、 CPU 的基本功能**

CPU 的核心任务是周而复始地执行指令，并处理可能发生的异常和中断。具体功能如下：

*   **控制程序的执行顺序:** 确保指令按照预定的逻辑顺序执行。
*   **控制指令进行什么操作:** 解释指令，并指挥相关部件完成指令所规定的操作。
*   **控制每个操作何时进行:** 提供精确的时序控制，协调各部件的工作。
*   **对数据进行算术或逻辑运算:** 执行指令中的数据处理操作。
*   **控制对存储器或I/O的访问:** 管理CPU与存储器和I/O设备之间的数据交换。
*   **判断有无异常或中断并调出相应处理程序:** 监测并响应系统内部的异常事件和外部的中断请求。

**二、 CPU 的基本结构**

CPU 主要由两大部分组成：

*   **数据通路 (Datapath):** 负责数据的存储、传送和处理。
    *   **包含的单元:**
        *   **组合逻辑单元:** 用于对数据进行处理，如加法器、算术逻辑单元(ALU)、扩展器（0扩展或符号扩展）、多路选择器等。这些单元的输出仅取决于当前的输入。
        *   **状态单元 (存储单元):** 用于存储指令执行过程中的中间状态或最终结果，如触发器、寄存器等。
*   **控制单元 (Control Unit):** 负责产生控制信号，指挥数据通路按正确的顺序和时序完成指令规定的操作。
    *   **功能:** 对取出的指令进行译码，并结合指令执行过程中得到的条件码或当前机器的状态、时序信号等，生成对数据通路进行控制的控制信号。

**三、 CPU 中的寄存器**

CPU内部包含多种类型的寄存器，用于暂存数据、地址或控制信息。

*   **用户可见寄存器:** 用户程序中的指令可以直接访问或间接修改其值的寄存器。
    *   **通用寄存器:** 可用来存放地址或数据。
    *   **地址寄存器:** 专门用来存放某种类型的地址信息，如段寄存器、变址寄存器、基址寄存器、堆栈指针、帧指针等。
    *   **程序计数器 (PC):** 存放当前或下一条将要执行指令的地址。
*   **用户部分可见寄存器:** 用户程序中的指令通常只能读取部分信息，而不能直接修改其内容。
    *   **程序状态字寄存器 (PSWR) 或标志 (条件码) 寄存器:** 其内容由CPU根据指令执行结果自动设定，用户程序指令通常只能隐含地读取其部分内容（如用于条件转移），而不能直接修改。
*   **用户不可见寄存器 (CPU内部寄存器):** 用于记录控制和状态信息，只能由CPU硬件或操作系统的内核程序访问，用户程序不可访问。
    *   **指令寄存器 (IR):** 存放正在执行的指令。
    *   **存储器地址寄存器 (MAR):** 存放将要访问的存储单元的地址。
    *   **存储器缓冲 (数据) 寄存器 (MBR 或 MDR):** 存放从存储器读出或将要写入存储器的数据。
    *   **其他寄存器:** 如中断请求寄存器、进程控制块指针、系统堆栈指针、页表基址寄存器等。

**四、 指令执行过程与周期概念**

*   **指令执行过程:** 通常包括取指令、译码、取操作数、执行运算、存储结果、检查中断等阶段。
*   **指令周期:** CPU取出并执行一条指令所花费的时间。它由若干个机器周期或直接由若干个时钟周期组成。
*   **机器周期 (总线周期):** CPU通过一次总线事务来访问一次主存或I/O的时间。一个机器周期由多个时钟周期组成。（注意：现代计算机已淡化机器周期的概念，指令周期直接由若干时钟周期组成）。
*   **时钟周期 (节拍/状态周期):** CPU中用于控制信号同步的最小时间单位，即时钟信号的周期。

**五、 数据通路的定时方式**

现代计算机都采用**时钟信号**进行定时。一旦时钟的有效边沿信号到来，数据通路中的状态单元（如寄存器）开始根据输入信号写入新的状态。

**六、 数据通路中信息的流动过程**

*   每条指令的功能不同，因此在执行时数据在数据通路中所经过的部件和路径可能不同。
*   但所有指令在**取指令阶段**所经过的路径和操作是相同的。

**七、 控制单元的实现方式**

根据控制信号产生方式和控制逻辑描述方式的不同，控制单元主要有两种实现方式：

*   **硬连线路控制器:**
    *   **原理:** 将指令执行过程中每个时钟周期所包含的控制信号取值组合看作一个“状态”。每到来一个时钟，控制信号会根据当前状态和输入（如指令操作码、条件码等）产生一组新的取值，即进入一个新的“状态”。整个指令的执行过程可以用一个有限状态转换图来描述。
    *   **实现:** 用一个组合逻辑电路（通常是PLA电路）来生成控制信号，用一个状态寄存器来实现状态之间的转换。
    *   **特点:** 速度快，但设计复杂，修改困难。
*   **微程序控制器:**
    *   **原理:** 将指令执行过程中每个时钟周期所包含的控制信号取值组合看作一个0/1序列，每个控制信号对应一个“微命令”，不同的控制信号取值对应不同的微命令。若干个微命令组合成一条“微指令”，每条指令所包含的动作序列由若干条微指令来完成，形成一个“微程序”。
    *   **实现:** 每条指令对应的微指令序列事先存放在一个只读存储器（称为控制存储器，简称控存）中。执行指令时，先找到对应的第一条微指令地址，然后按照特定的顺序取出后续微指令并执行。
    *   **定序:** 微程序定序器负责控制微指令的执行流程，其实现方式有计数器法和断定法（即下地址字段法）两种。
    *   **特点:** 设计规整，易于修改和扩展，但速度相对较慢。

**八、 异常和中断**

*   **异常 (内部中断 / 内中断):** 指CPU内部在执行某条指令时发生的程序异常或硬件异常。
    *   **类型:**
        *   **故障 (Fault):** 由某条正在执行的指令产生的异常，如“溢出”、“除数为0”、“非法操作码”、“缺页”、“地址越界”、“访问越权”、“段不存在”、“堆栈溢出”等。有些故障修复后程序可以继续执行，有些则不能修复，只能中止异常程序的执行。
        *   **陷阱 (Trap):** 是预先安排的一种“异常”事件，例如断点设置、单步跟踪、系统调用、条件自陷等引起的。
        *   **终止 (Abort):** 严重的硬件故障，一旦发生只能终止整个系统的运行，重启系统。
*   **中断 (外部中断 / 外中断):** 指外部设备或其它处理机通过中断请求线向CPU提出的处理请求，与当前CPU正在执行的指令无关，是一种I/O方式。

