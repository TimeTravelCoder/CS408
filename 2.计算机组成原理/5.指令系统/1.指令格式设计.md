好的，这是关于 "5.1 指令格式设计" 的学习笔记：

## 5.1 指令格式设计

### 5.1.1 指令地址码的个数
冯·诺依曼结构计算机采用“存储程序”的工作方式。程序一旦启动运行，计算机必须能够自动地逐条从主存取出指令执行，并且在一条指令执行结束后能够自动转到下一条指令执行。
为此，一条指令中必须明显或隐含地包含以下信息：
1.  **操作码 (Opcode)：** 指定操作的类型，如移位、加减乘除、传送等。
2.  **源操作数或其地址 (Source Operand or its Address)：** 指出一个或多个源操作数或其所在的地址。这可以是主(虚)存地址、寄存器编号或 I/O 端口，也可以是指令中直接给出的立即数。
3.  **结果的地址 (Result Address)：** 产生结果所存放的地址。这可以是主(虚)存地址、寄存器编号或 I/O 端口。
4.  **下条指令地址 (Next Instruction Address)：** 下条指令存放的地址，可以是主(虚)存地址。
通常情况下，下条指令的地址不需要在指令中明显给出，而是隐含在程序计数器 (PC) 中。顺序执行时，PC 的值会自动加上指令的长度得到下一条指令的地址；遇到转移指令时，则由指令给出转移到的目标地址。
一条指令由一个操作码和几个地址码构成。根据包含的地址个数，可分为以下几类：
*   **(1) 三地址指令 (Three-Address Instruction)**
    *   格式：`OP D1 D2 D3`
    *   含义：`(D1) OP (D2) -> D3`
    *   说明：分别作为双目运算中两个源操作数的地址和一个结果的地址。
*   **(2) 二地址指令 (Two-Address Instruction)**
    *   格式：`OP D1 D2`
    *   含义：`(D1) OP (D2) -> D2`
    *   说明：分别存放双目运算中两个操作数，并将其中一个地址作为结果的地址。
*   **(3) 单地址指令 (One-Address Instruction)**
    *   格式：`OP D`
    *   含义 (单目运算)：`OP (D) -> D` (例如取反、取负等)，其地址既是操作数的地址，也是结果的地址。
    *   含义 (双目运算)：`(D) OP (A) -> A` (其中 A 代表累加器)，另一个操作数和结果默认存放在累加器 A 中。

*   **(4) 零地址指令 (Zero-Address Instruction)**
    *   说明：这类指令无操作数，所以无地址码。
    *   例如：空操作、停机等不需要地址的指令。
    *   或者操作数隐含在堆栈中，其地址由栈指针给出的指令等也是零地址指令。

### 5.1.2 指令格式设计原则

指令格式的选择应遵循如下几条基本原则：

1.  **指令应尽量短：** 指令长度短，使得程序占用存储空间小，降低空间开销。
2.  **要有足够的操作码位数：** 为保证向后兼容，指令操作类型会不断增加，因此必须预留足够的操作码位数。
3.  **操作码的编码必须有唯一的解释：** 操作码要么是一个唯一的合法编码，要么是不合法的序列。当译码器发现不合法操作码时，会产生“非法指令”异常。
4.  **指令长度应是字节的整数倍：** 指令存放在内存中，而内存往往按字节编址，指令长度为字节的整数倍便于指令的读取和指令地址的计算。
5.  **合理选择地址字段的个数：** 地址字段个数涉及到指令的长度和指令的规整性问题，是空间开销和时间开销权衡的结果。
6.  **指令应尽量规整：** 指令的规整性体现在：
    *   指令长度是否固定。
    *   操作码位数是否固定。
    *   地址码格式是否一致。
    *   指令字中各字段的划分位置是否一致等。
    规整的指令系统会大大简化硬件的实现。