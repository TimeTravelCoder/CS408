好的，这是关于“8.2 总线设计的要素”的学习笔记：

## 8.2 总线设计的要素

尽管有许多不同的总线实现方式，但总线设计的基本要素和考察的性能指标都是一样的。总线设计时要考虑的基本要素包括信号线类型、事务类型、总线带宽、仲裁方法和定时方式等。

### 8.2.1 信号线类型

总线的信号线类型有**专用**和**复用**两种。

*   **专用信号线**：信号线专门用来传送某一种信息。
    *   **优点**：不同信息可以同时传输，如“存储器写”总线事务中，主存单元地址和数据可以同时送到总线上。
    *   **缺点**：需要更多的信号线，成本较高。
    *   **例如**：使用分立的数据线和地址线分别专门用来传送数据和地址。

*   **复用信号线**：用同一种信号线在不同的时间传输不同的信息。
    *   **优点**：可以使用较少的信号线传输更多的信息，从而节省空间和成本。
    *   **缺点**：
        *   挂接的每个部件的电路变得更复杂。
        *   限定了共享同一组信号线的事件不能同时发生，可能降低性能。
    *   **例如**：采用数据/地址线分时复用方式，用一组数据线在总线事务的地址阶段传送地址信息，在数据阶段传送数据信息。

### 8.2.2 总线事务类型

通常把在总线上一对设备之间的一次信息交换过程称为一个“**总线事务**”。
*   **主控设备 (请求代理)**：发出事务请求的部件。
*   **从设备 (响应代理)**：响应请求的部件。
*   **例如**：处理器要求读取存储器中某单元的数据，则处理器是主控设备，存储器是从设备。

总线事务类型通常根据其**操作性质**来定义。
*   **典型的总线事务类型**：
    *   存储器读 (Memory Read)
    *   存储器写 (Memory Write)
    *   I/O 读 (I/O Read)
    *   I/O 写 (I/O Write)
    *   中断响应 (Interrupt Acknowledge / Interrupt Response)
*   **一次总线事务简单来说包括两个阶段**：
    *   地址阶段
    *   数据阶段

*   **突发 (Burst) 传送事务 (成组传送事务)**：
    *   由一个地址阶段和多个数据阶段构成。
    *   用于传送多个连续单元的数据，地址阶段送出的是连续区域的首地址。
    *   一次突发传送事务可以传送多个数据。

不同总线规定的事务类型不一样，通常一个总线可以有多种不同的事务类型，不同事务类型的总线传输过程不同。

**例如：Pentium Pro 处理器总线的主要事务类型 (11 种)**：
*   **延迟回答 (Deferred Reply)**：当从设备需要很长时间才能完成某个操作时，通过发出“延迟回答”事务以“分离事务”方式来处理。需要对主控设备进行寻址，以便将被延迟事务的完成状态以及所读数据（如果是读事务的话）发送给主控设备。
*   **中断响应 (Interrupt Acknowledge)**：当处理器响应从 8259 中断控制器送来的中断请求而去读中断向量时，处理器就发出“中断响应”事务。
*   **特殊事务 (Special Transaction)**：当处理器广播一条与某内部事件 (如 shutdown、halt 等) 有关的消息时，就产生“特殊事务”。
*   **分支跟踪消息 (Branch Trace Message)**：在指令执行过程中当一个分支指令的条件满足时，处理器就生成“分支跟踪消息”事务。它将送出转移指令的地址和转移到的目标指令的地址。
*   **I/O 读 (I/O Read)**：当执行输入指令 IN 或 INS 要从某 I/O 设备读取数据或状态时，处理器发出“I/O 读”事务。
*   **I/O 写 (I/O Write)**：当执行输出指令 OUT 或 OUTS 将数据或命令写到某 I/O 设备时，处理器发出“I/O 写”事务。
*   **存储器读并无效 (Memory Read and Invalidate)**：处理器产生“存储器读并无效”事务，主要是为了对一个主存块进行独占访问。
*   **存储器代码读 (Memory Code Read)**：当处理器要从存储器中取指令时产生“存储器代码读”事务。
*   **存储器数据读 (Memory Data Read)**：当某指令需要从存储器中取数据时，产生“存储器数据读”事务。
*   **存储器写(不可重试) (Memory Write (non-retryable))**: 当处理器要写回一个被更新过的主存块到存储器以便为一个新的主存块腾出一个 cache 行时，由处理器发出该事务。
*   **存储器写(可重试) (Memory Write (retryable))**: 当某指令需写数据到存储器时，由处理器发出该事务。

**Pentium Pro 处理器总线的每个总线事务包含以下 5 个操作阶段**：
1.  **请求(地址)阶段 (Request (Address) Phase)**：送出地址、事务类型及有关事务的其他信息。
2.  **检错阶段 (Error Phase)**：对请求阶段送出的地址和请求事务信息进行奇偶校验检测。
3.  **侦听阶段 (Snoop Phase)**：对请求阶段送出的地址检查其在 cache 中的命中情况，以确定以后阶段该如何处理该事务。
4.  **响应阶段 (Response Phase)**：根据请求的事务类型、检错和侦听结果，确定如何响应当前事务。返回的响应结果可以是重试事务、延迟事务、硬件错、无数据传送事务、回写 (write back) 事务或正常数据传送事务等。对于前 4 种情况，事务在响应阶段就可结束。
5.  **数据阶段 (Data Phase)**：送数据到数据总线上，或从数据总线上取数据。

### 8.2.3 总线带宽

总线带宽指总线的**最大数据传输率**，即总线在进行数据传输时单位时间内最多可传输的数据量，不考虑其他如总线裁决、地址传送等所用的时间。

对于**同步总线**，其总线带宽的计算公式为：
`B = W × F / N`
其中：
*   `B`：总线带宽 (通常单位为 MBps 或 GBps)
*   `W`：总线宽度，即总线能同时并行传送的数据位数 (通常以字节为单位)
*   `F`：总线的时钟频率 (单位 Hz)
*   `N`：完成一次数据传送所用的时钟周期数

**例 8.1**
*   假定某同步总线在一个时钟周期内传送一个 4 字节的数据，总线时钟频率为 33MHz。
    *   总线带宽 = 4B × 33MHz / 1 = 132MBps。
*   如果总线宽度改为 64 位 (8 字节)，一个时钟周期能传送两次数据，总线时钟频率为 66MHz。
    *   完成一次数据传送所用的时钟周期数 N = 1 / 2 = 0.5。
    *   总线带宽 = 8B × 66MHz / 0.5 = 1056MBps。
    *   性能提高了 1056 / 132 = 8 倍。

### 8.2.4 总线裁决 (总线仲裁)

总线是共享的传输介质，一组总线被挂接在其上的所有设备共享，因此，**某一时刻只能有一对设备使用总线进行数据传输**。当多个设备需要使用总线进行通信时，每个设备为各自的传输都试图将信号送到总线上，如果没有任何控制，就会产生冲突。

这种冲突可以通过引入一个或多个**总线主控设备**而加以避免。
*   **主控设备 (Master)**：控制对总线的访问，能够发起并控制所有总线请求。
*   **从设备 (Slave)**：只能响应从主控设备发来的总线命令，每个总线事务总是在一对主、从设备之间进行数据传送。
    *   例如：处理器通过总线访问存储器，处理器总是主控设备，存储器总是从设备（因为它只能响应读或写请求，不会产生请求）。

*   **单主控设备系统**：最简单的计算机系统只有一个单总线，且总线中只有一个主控设备：处理器。所有总线操作都必须由处理器控制，所以无须总线裁决。
    *   **缺点**：处理器必须介入到每个总线事务中。

*   **多主控设备系统**：每个主控设备都能启动数据传送。因此，必须提供一种机制用来决定在某个时刻由哪个设备拥有总线使用权。决定哪个主控设备能得到总线使用权的过程称为**总线裁决 (Bus Arbitration)**。

**总线裁决的方案**：
粗略来分，有两类总线裁决方式：**集中式**和**分布式**。

*   **集中式裁决**：将控制逻辑做在一个专门的**总线控制器**或**总线裁决器**中，使所有的总线请求集中起来，利用一个特定的裁决算法进行裁决。
    *   **常用的集中裁决方式有三种**：链式查询、计数器定时查询和独立请求。

    *   **(a) 链式查询方式 (菊花链查询方式 - Daisy Chain)** (图 8.1a)
	    * ![[image-348.png]]
        *   **控制线**：
            *   D：双向数据线
            *   A：单向地址线
            *   BS (Bus Busy)：总线忙信号
            *   BR (Bus Request)：总线请求信号
            *   BG (Bus Grant)：总线允许信号
        *   **过程**：
            1.  主控设备的总线请求信号 BR 通过“线或”方式送到总线裁决器。
            2.  总线裁决器接收到 BR 后，在总线空闲 (BS=0) 的情况下，将总线允许信号 BG 通过总线允许线从最高优先权的设备依次向最低优先权的设备串行传送。
            3.  如果 BG 信号到达的设备有总线请求，则 BG 信号不再往下传，该设备获得总线使用权，并建立总线忙 BS 信号。
        *   **优先级**：由主控设备在总线上的位置决定，高优先级设备简单地拦截 BG 信号。
        *   **优点**：简单，只需很少几根线，扩充设备较简单。
        *   **缺点**：
            *   不能保证公正性 (低优先级请求可能永远得不到允许)。
            *   对电路故障敏感 (前面设备的故障会影响 BG 信号向后面设备的传递)。
            *   菊花链的使用限制了总线速度，裁决速度较慢。

    *   **(b) 计数器定时查询方式** (图 8.1b)
        *   **控制线变化**：比链式查询多了一组设备地址线，少了一根总线允许线 BG。
        *   **过程**：
            1.  总线裁决器接收到 BR 送来的总线请求信号后，在总线空闲的情况下，由计数器开始计数，并将计数值通过设备地址线向各设备发出。
            2.  当某个发出总线请求的设备的编号与设备地址线上的计数值一致时，该设备便获得总线使用权，此时终止计数查询，同时该设备建立总线忙 BS 信号。
        *   **优先级**：
            *   计数器的初始值可由程序设置，从而改变优先级。
            *   若每次计数总是从 0 开始，则优先级固定。
            *   若每次计数的初始值总是上次得到控制权的设备随后设备的编号，则所有设备的优先级平等（循环优先级）。
        *   **优点**：优先级灵活，对电路故障不像菊花链那样敏感。
        *   **缺点**：增加了一组设备地址线，每个设备要对设备地址进行译码处理，控制较复杂。

    *   **(c) 独立请求方式** (图 8.1c)
        *   **控制线**：每个设备都有一对总线请求线 BRi 和总线允许线 BGi，各个设备独立请求总线。
        *   **过程**：
            1.  当某个设备要求使用总线时，通过其对应的 BRi 线将请求信号送到总线裁决器。
            2.  总线裁决器中有一个判优电路，可根据各个设备的优先级确定选择哪个设备使用总线。
            3.  通过对应的 BGi 线发出总线允许信号。
        *   **优先级**：裁决器可以给各个请求线以固定的优先级，也可以通过编程方式设置优先级。
        *   **优点**：响应速度快；如果是可编程的，优先级还可灵活设置。
        *   **缺点**：控制逻辑较复杂，控制线数量比其他两种方式多 (例如，n 个设备需要 2n 根裁决线，而菊花链只需两根，计数查询大致需 log₂n 根)。
        *   **裁决算法**：在总线裁决器中由硬件实现，可以采用固定的并行判优算法、平等的循环菊花链算法、动态优先级算法（如最近最少用算法、先来先服务算法）等。
        *   **组合方式**：有些总线将查询方式和独立请求方式结合。例如，VME 总线使用了多个菊花链，每个菊花链具有一对独立的请求线和允许线，一个并行判优的优先权编码器从多个请求线中选择。

*   **分布式裁决方式**：没有专门的总线控制器，其控制逻辑分散在各个部件或设备中。
    *   主控设备使用总线请求信号进行总线请求，获得总线控制权后，设备就可以使用总线。使用完总线后，设备通过某种方式向裁决器发出信号，表示不再需要总线，此时裁决器将总线再分配给另一个设备。
    *   用于总线裁决的信号线在物理上可以是单独的，有时则采用信号线复用的方式（如利用数据线进行总线请求），但这种情况下总线裁决和数据传输不能同时进行。
    *   **裁决方案需考虑的平衡因素**：
        *   **等级性**：每个主控设备有一个总线优先级，具有最高优先级的设备应该先被服务。
        *   **公平性**：任何设备，即使是具有最低优先权的设备也不能永远得不到总线使用权。
    *   **其他考虑因素**：缩短总线裁决时间，裁决时间应尽量与总线传送操作在时间上重叠。

    *   **常用的分布式裁决方式有三种**：自举分布式、冲突检测分布式和并行竞争分布式。

    *   **(1) 自举分布式裁决** (图 8.2)
	    * ![[image-349.png]]
        *   **假设**：总线上有 4 个设备，唯一标识号从 0 到 3，设备 0 优先级最低，设备 3 最高。BR₀ 为总线忙信号线，BRᵢ (i=1 到 3) 为设备 i 的总线请求线。
        *   **过程**：
            *   设备 0：在确认 BR₀ 上没有有效信号 (总线空闲) 且 BR₁、BR₂ 和 BR₃ 上没有其他设备发出的请求信号时，它就使用总线，将 BR₀ 信号线置为有效。
            *   设备 1：在确认总线空闲且 BR₂ 和 BR₃ 上没有请求信号时能使用总线。
            *   设备 2：在确认总线空闲且 BR₃ 上没有请求信号时就能使用总线。
            *   设备 3：在总线空闲时可直接使用总线。
        *   **特点**：
            *   不需要集中的总线裁决器，每个设备独立决定自己是否是最高优先级的请求者。
            *   优先级固定。
            *   每个需要请求总线控制权的设备在各自对应的总线请求线上送出请求信号。
            *   在总线裁决期间，每个设备通过取回的信息能够检测出其他比本设备优先级高的设备是否发出了总线请求。如果没有，则立即使用总线，并通过总线忙信号阻止其他设备使用总线；如果检测到更高优先级的请求，则本设备不能马上使用总线。
        *   **缺点**：需要较多的连线用于请求信号，所以许多采用这种方案的总线用数据线 DB 作为总线请求线。
        *   **应用**：早期 Macintosh II 中的底板式总线 NuBus，SCSI 总线接口。

    *   **(2) 冲突检测分布式裁决**
        *   **过程**：
            1.  当某个设备要使用总线时，它首先检查是否有其他设备正在使用总线。
            2.  如果没有，那它就置总线忙，然后使用总线。
            3.  若两个设备同时检测到总线空闲，那它们可能都会立即使用总线，此时便发生了冲突。
            4.  一个设备在传输过程中，它会侦听总线以检测是否发生了冲突。
            5.  当发现冲突时，两个设备都会停止传输，延迟一个随机时间后再重新使用总线。
        *   **类比**：两个有礼貌的人发现自己和对方同时走上一个独木桥后，两人又都同时退回，过一个随机时间段后，就可能有一人先走。
        *   **应用**：一般用在网络通信总线上，例如，以太网。

    *   **(3) 并行竞争分布式裁决**
        *   **特点**：较复杂但有效。
        *   **基本思想**：总线上的每个设备都有一个唯一的仲裁号，需要使用总线的主控设备把自己的仲裁号发送到仲裁线上，这个仲裁号将用在并行竞争算法中。每个设备根据仲裁算法决定在一定的时间段后占用总线还是撤销仲裁号。
        *   **裁决过程** (图 8.3)：
	        * ![[image-350.png]]
            *   设备和总线采用相反的逻辑 (设备正逻辑，总线负逻辑)。
            *   假定总线中有 8 根仲裁线 AB0~AB7。所有需要使用总线的主控设备把自己的仲裁号 cn0~cn7 (相当于设备号) 发送到这 8 根仲裁线上。
            *   根据并行竞争算法，发送最大仲裁号的设备将获得总线使用权。
            *   **仲裁线逻辑**：“线或”。只要有一个设备把逻辑“1”送到某个特定的仲裁线上，那么这根线的信号就是“1” (即低电平)。
            *   **裁决逻辑**：每个设备中的裁决逻辑检测仲裁线上的结果，并根据以下规则修改它放到总线上的仲裁号：如果该设备的仲裁号中有某一位为 0，而这一位对应的仲裁线信号为“1”，则修改这个仲裁号，使其所有低位都从总线上撤销 (即使所有低位对应的仲裁线送出一个为“0”的信号)。这样，具有最高仲裁号的设备将会发现它的仲裁号和留在仲裁线上的号匹配，所以它将赢得总线使用权。
        *   **优点**：可以用很少的裁决线挂接大量的设备。例如，8 位仲裁号，自举分布式裁决只能表示 8 个优先级，而这种方式可以表示 256 个优先级 (仲裁号 255 优先级最高，0 最低)。
        *   **应用**：Futurebus+ 总线标准。

### 8.2.5 定时方式

通过总线裁决确定了哪个设备可以使用总线，那么一个取得了总线控制权的设备如何控制总线进行总线操作呢？也即，如何来定义总线事务中的每一步何时开始、何时结束呢？这就是总线通信的**定时问题**。

总线通信的定时方式有 4 种：**同步、异步、半同步和分离事务**。

1.  **同步通信方式**
    *   采用**公共的时钟信号**进行定时，挂接在总线上的所有设备都从一个公共的时钟线上获得定时信号。
    *   一定频率的时钟信号定义了等间隔的时间段，这个固定的时间段为一个**总线时钟周期**。
    *   **传输协议简单**：只要在规定的第几个时钟周期内完成特定的操作即可。
        *   **例如：“存储器读操作”协议** (图 8.4)：
	        * ![[image-351.png]]
            *   主控设备 (处理器) 在第一个时钟周期发送存储地址和存储器读命令。
            *   从设备 (存储器) 总是在第 5 个时钟周期将数据放到总线上作为响应。
            *   处理器也在第 5 个时钟周期从数据线上取数据。
            *   “存储器写”操作的同步时序类似。
    *   **优点**：
        *   很容易用一个有限状态机实现。
        *   总线速度非常快，接口逻辑少。
        *   处理器-主存总线都是同步的 (通信设备靠得很近，数量少)。
    *   **缺点**：
        *   **总线定时以最慢设备所花时间为标准**，所以同步总线适合于存取时间相差不大的多个功能部件之间的通信。
        *   **时钟偏移问题**：导致同步总线不能过长，否则会降低总线传输效率。
        *   **可靠性不高**：每一步操作的开始都不管前面操作结果是否正常结束。

2.  **异步通信方式**
    *   不采用时钟定时，而是采用“**异步应答**”方式进行定时，也称为“**握手协议 (Handshaking Protocol)**”。
    *   握手协议由一系列步骤组成，只有当双方都同意时，发送者或接收者才会进入到下一步。
    *   协议通过一组附加的“**握手”控制信号线**来实现。
    *   **优点**：
        *   能够连接带宽范围很大的各种设备。
        *   总线能够加长而不用担心时钟偏移问题。
        *   能更好地适应技术的改变，并能支持更大范围内的响应速度。
    *   **缺点**：比同步总线慢，因为异步通信需要进行握手，增加了开销。

    *   **例子：存储器读操作的异步通信协议** (图 8.5)
	    * ![[image-352.png]]
        *   **控制信号线**：
            *   ReadReq (读请求)
            *   Ready (数据就绪)
            *   Ack (回答)
        *   **步骤 (7 个)**：
            1.  **①** 主设备发出 ReadReq 信号和地址信息。存储器接收到 ReadReq 信号后，从地址线上读取地址信息，同时送出 Ack 信号 (表示已接受请求和地址)。
            2.  **②** 主设备收到存储器送出的 Ack 信号后，接着就撤销 ReadReq 信号和地址线。
            3.  **③** 存储器发现 ReadReq 被释放后，就跟着也撤销 Ack 信号。 (完成一次完整的应答过程，地址和读命令交换完毕)
            4.  **④** 当存储器完成数据的读出后，就将数据放到数据线上，并送出 Ready 信号。
            5.  **⑤** 主设备接收到存储器送出的 Ready 信号后，就从数据线上开始读，并送出 Ack 信号 (向存储器表明数据已被读)。
            6.  **⑥** 存储器接收到 Ack 信号后，得知数据已被成功读取。此时，它就撤销 Ready 信号，并撤销数据线。
            7.  **⑦** 主设备发现 Ready 撤销后，跟着也撤销 Ack 信号。 (又一次完整的应答过程，数据信息交换完毕)
        *   **工作方式**：像一对有限状态机，一个设备直到它知道另一个设备已经到达一个特定的状态时才进入到下一状态。

    *   **异步通信的三种可能的应答方式 (互锁方式)** (图 8.6)：
    * ![[image-353.png]]
        *   **(a) 非互锁方式**：
            *   发送部件将数据放在总线上，延迟一定时间后就发出数据就绪信号 Ready。
            *   接收部件根据 Ready 接收数据，并发出应答信号 Ack。
            *   发送部件收到 Ack 后就可撤销数据。
            *   **特点**：只有一次握手，经过一个固定时间后，握手信号自动撤销。
            *   **缺点**：如果总线上各设备速度差异很大，就不能保证握手信号在规定时间内到达对方，因此在某些情况下不可靠。
        *   **(b) 半互锁方式**：
            *   握手过程类似于非互锁方式，只是让就绪信号 Ready 一直有效，直到接收到另一方送来的应答信号 Ack 为止。
            *   **特点**：有两次握手，就绪信号的宽度由这两次握手信号控制，而回答信号在一个固定时间后自动撤销。
        *   **(c) 全互锁方式**：
            *   发送部件将数据放在总线上后就发出数据就绪信号 Ready。
            *   接收部件在接收到 Ready 后接收数据，并发出应答信号 Ack。
            *   发送部件收到 Ack 信号后才复位就绪信号。
            *   接收部件在检测到就绪信号复位后，才复位应答信号。
            *   **特点**：有三次握手，就绪信号和应答信号的宽度都由握手信号控制，都可依据传输情况变化。
            *   **优点**：可以挂接各种具有不同工作速度的设备。
            *   **应用**：图 8.5 示意的是全互锁方式，共有 7 次握手过程，被广泛运用。

    **例 8.2：同步与异步总线性能比较**
    *   **同步总线**：时钟周期 50ns，传输一个数据需一个时钟周期。
    *   **异步总线**：每次握手 40ns。
    *   **数据宽度**：均为 32 位。
    *   **存储器准备数据时间**：200ns。
    *   **同步总线读操作时间**：
        1.  发送地址和读命令到存储器：50ns
        2.  存储器读数据：200ns
        3.  传送数据到设备：50ns
        *   总时间 = 50 + 200 + 50 = 300ns
        *   数据传输率 = 4B / 300ns = 13.3MBps
    *   **异步总线读操作时间 (参考图 8.5)**：
    * ![[image-354.png]]
        *   第 ① 步：40ns
        *   第 ②、③、④ 步：与存储器访问时间重叠， Max(3 × 40ns, 200ns) = 200ns
        *   第 ⑤、⑥、⑦ 步：3 × 40ns = 120ns
        *   总时间 = 40 + 200 + 120 = 360ns
        *   数据传输率 = 4B / 360ns = 11.1MBps
    *   **结论**：同步总线仅比异步总线快大约 20%。当然，异步总线上的设备和存储器系统必须足够快，以使每次在 40ns 内能完成握手过程。

3.  **半同步通信方式**
    *   异步通信对噪声较敏感。为解决此问题，在异步总线中引入**时钟信号**。
    *   规定**握手信号总是在时钟信号的边沿被采样**，这样，信号的有效时间仅限制在特定的时刻，而不受其他时间的信号的干扰。
    *   **特点**：所有事件都由时钟信号定时，但信息的交换又由就绪和应答等握手信号控制。
    *   **示意图** (图 8.7)：![[image-355.png]]
        *   在同步时钟信号定时的基础上，引入一个 WAIT 信号。
        *   在时钟信号的上升沿，主设备采样 WAIT 信号，以察看从设备是否已完成相应任务。
        *   如果 WAIT 信号无效，则说明没有就绪，继续等待一个时钟 (插入等待时钟 Tw)，直到 WAIT 信号有效为止。
        *   当采样 WAIT 信号有效时，主设备就开始从数据线上取数据。
        *   有些半同步总线 (如 PCI 总线) 对主设备和从设备各引入一条就绪信号线 (如 PCI 的 “TRDY” 和 “IRDY”)。
    *   **优点**：
        *   既保持了“所有信号都由时钟定时”的同步总线特点。
        *   又有“速度差异较大的设备可共存于同一总线”的异步总线特点。

4.  **分离事务通信方式 (Split Transaction Protocol)**
    *   **背景**：在例 8.2 中，当存储器进行读操作时，若总线继续进行存储器读事务，那么总线将有 4 个时钟周期没有进行实际的传输。如果这时候释放总线，那么这 4 个时钟周期可被其他事务所用。
    *   **步骤**：
        1.  总线主控设备向存储器发出信号，送出地址和请求类型。
        2.  当存储器回答完请求后，主控设备释放所有信号线。
        3.  存储器访问开始，在存储器访问期间其他总线主控设备能使用总线。
        4.  存储器向主控设备发出信号表示数据已经可用。
        5.  主控设备通过总线接收数据，并向存储器指示它已获取数据，存储器可从总线上撤销信号。
    *   **示意图** (图 8.8)：将一个传输操作事务的过程分成两个子过程。
	    * ![[image-356.png]]
        *   **子过程 1**：主控设备 M 获得总线使用权后，将请求的事务类型 (总线命令)、地址及其他有关信息 (如标识主控设备身份的编号等) 发送到总线上，从设备 S 记录下这些信息。主控设备发送这些信息只需很短的时间，发完后便立即释放总线，这样其他设备便可使用总线。同时，从设备 S 收到主控设备 M 发来的信息后，按照其请求的命令进行相应的操作。
        *   **子过程 2**：当从设备 S 准备好主控设备所需的数据后，便请求使用总线，一旦获得使用权，则从设备 S 就将主控设备 M 的编号及所需的数据等送到总线上，这样主控设备 M 便可接收数据。
    *   **优点**：
        *   在不传送数据期间释放总线，使其他申请者能使用总线，实现了一个总线为多个主/从设备进行交叉并行传送的方式。
        *   可改进整个系统的总线有效带宽。
        *   当从设备准备数据的过程相当复杂、所需时间长，从而引起多个事务重叠时，效果更明显。
    *   **缺点**：
        *   控制相当复杂，一般在大型计算机系统和高档微机系统中使用。
        *   完成一个事务的时间可能会增加 (因为需要两次获得总线)。
        *   实现起来开销大 (需要跟踪在一次通信中的另一方，从设备必须和请求方联系)。

**总结：影响总线事务数据传输率的因素**
*   **(1) 与总线带宽有关**：总线带宽由总线宽度、时钟频率和传输每个数据所用时钟周期数确定。
*   **(2) 与总线裁决方式有关**：总线裁决方式和裁决速度会影响总线事务所用时间。有些总线在数据传输时进行总线裁决，因而裁决阶段是隐含的，不占用总线事务时间。
*   **(3) 与总线定时方式有关**：同步总线用时钟信号同步，比异步总线需要握手应答快。分离事务方式由于实现了多个事务交叉并行传送，提高了总线的利用率，从而提高了总线的总体数据传输率。
*   **(4) 与信号线类型有关**：信号线分时复用有时会减慢总线的传输速度 (如地址线和数据线分时复用时，写操作不能将地址和数据同时传送出去)。
*   **(5) 与是否采用突发传送有关**：突发传送方式下，只要传送一个首地址，然后就可连续传送多个数据而不释放总线，减少了数据传送过程中的地址传送和申请/释放总线等开销，提高了总线传输速率。

**总线设计的困难**：总线速度受到总线长度和部件个数的限制。提高总线性能的技术可能反过来影响其他性能（例如，简化通信路径以减少访问时间，但为了获得高 I/O 数据传输率又需最大化一次总线传输的数据量，这两个目标是矛盾的）。支持大范围内不同等待时间和不同数据传输率的设备的需求也使总线设计面临挑战。