
### 2.6.1 数据的宽度和单位
1.  **基本表示形式**：计算机内部任何信息都被表示成二进制编码形式。
2.  **基本单位**：
    *   **比特 (bit)**：二进制数据的每一位 (0 或 1) 是组成二进制信息的最小单位，称为一个“比特”，或称“位元”，简称“位”。比特是计算机中处理、存储和传输信息的最小单位。
    *   **字节 (Byte)**：二进制信息的计量单位，也称“位组”。
        *   **1 字节 = 8 比特**。
        *   一个西文字符通常需要 8 个比特 (1 字节) 表示。
        *   一个汉字通常需要 16 个比特 (2 字节) 表示。
    *   **字 (Word)**：计算机中运算和处理二进制信息时经常使用的单位。
        *   **重要特性**：不同计算机的字的长度和组成**不完全相同**。有的字由两个字节组成，有的由 4 个、8 个甚至 16 个字节组成。
3.  **机器字长 (Word Length / Word Size)**：
    *   **定义**：考察计算机性能时的一个重要指标。平时所说的“某种机器是 16 位机或是 32 位机”中的 16、32 就是指字长。
    *   **通常含义**：**CPU 内部用于整数运算的数据通路的宽度**。CPU 内部数据通路是指 CPU 内部数据流经的路径以及路径上的部件，主要是 CPU 内部进行数据运算、存储和传送的部件。这些部件的宽度基本上要一致，才能相互匹配。
    *   因此，“字长”等于 CPU 内部用于整数运算的**运算器位数**和**通用寄存器宽度**。
4.  **“字”与“字长”的区别**：
    *   **字 (Word)**：用来表示被处理信息的单位，用来度量各种数据类型的宽度。通常系统结构设计者必须考虑一台机器将提供哪些数据类型，每种数据类型提供哪几种宽度的数，这时就要给出一个基本的“字”的宽度。
        *   **示例**：Intel x86 微处理器中把一个字定义为 16 位。其提供的数据类型中，就有单字宽度的无符号数和带符号整数 (16 位)、双字宽度的无符号数和带符号整数 (32 位) 等。
    *   **字长 (Word Length)**：表示进行数据运算、存储和传送的部件的宽度，它反映了计算机处理信息的一种能力。
    *   **关系**：“字”和“字长”的长度可以一样，也可以不一样。
        *   **示例**：在 Intel 微处理器中，从 80386 开始就至少都是 32 位机器了，即字长至少为 32 位，但其字的宽度都定义为 16 位，32 位称为双字。
5.  **存储容量单位**：表示二进制信息存储容量时所用的单位要比字节或字大得多，主要有以下几种：
    *   **KiloByte (KB)**：1 KB = 2<sup>10</sup> 字节 = 1024 字节
    *   **MegaByte (MB)**：1 MB = 2<sup>20</sup> 字节 = 1048576 字节
    *   **GigaByte (GB)**：1 GB = 2<sup>30</sup> 字节 = 1073741824 字节
    *   **TeraByte (TB)**：1 TB = 2<sup>40</sup> 字节 = 1099511627776 字节
    *   **PetaByte (PB)**：1 PB = 2<sup>50</sup> 字节
    *   **ExaByte (EB)**：1 EB = 2<sup>60</sup> 字节
    *   **ZettaByte (ZB)**：1 ZB = 2<sup>70</sup> 字节
    *   **YottaByte (YB)**：1 YB = 2<sup>80</sup> 字节
6.  **10 的幂次表示 (速率等)**：在描述距离、频率等数值时通常用 10 的幂次表示。在由时钟频率计算得到的总线带宽或外设数据传输率中，度量单位表示的是 10 的幂次。
    *   **区分**：本书中用 **K** 表示 1024 (2<sup>10</sup>)，用 **k** 表示 1000 (10<sup>3</sup>)。其他前缀字母均为大写，表示的大小由其上下文决定。
7.  **带宽单位**：
    *   **比特/秒 (bps or b/s)**：有时也写为 bps。
    *   **千比特/秒 (kbps)**：1 kbps = 10<sup>3</sup> bps = 1000 bps
    *   **兆比特/秒 (Mbps)**：1 Mbps = 10<sup>6</sup> bps = 1000 kbps
    *   **吉比特/秒 (Gbps)**：1 Gbps = 10<sup>9</sup> bps = 1000 Mbps
    *   **太比特/秒 (Tbps)**：1 Tbps = 10<sup>12</sup> bps = 1000 Gbps
8.  **数据类型与硬件支持**：由于程序需要对不同类型、不同长度的数据进行处理，所以，计算机中底层机器级的数据表示必须能够提供相应的支持。例如，需要有处理单字节、双字节、4 字节、甚至是 8 字节整数的整数运算指令以及能够处理 4 字节、8 字节浮点数的浮点数运算指令等。
9.  **C 语言中数值数据类型的宽度 (表 2.9)**：
	   ![[image-120.png]]
    *   `char`：通常 1 字节，可表示 8 位整数。
    *   `short int`：通常 2 字节。
    *   `int`：典型 32 位机器为 4 字节。
    *   `long int`：长度与机器字长宽度相同 (例如 32 位机为 4 字节，64 位机为 8 字节)。
    *   指针 (`char *`)：宽度与长整数 (`long int`) 一样，也等于机器字长的宽度。
    *   `float` 和 `double`：一般机器都支持，分别对应 IEEE 754 单精度和双精度格式。
    *   **结论**：同一类型的数据在不同机器或不同编译器下，其宽度可能不同。
### 2.6.2 数据的存储和排列顺序
1.  **基本存储单位**：任何信息在计算机中用二进制被编码以后，得到的都是一串 0/1 序列，每 8 位构成一个字节。不同的数据类型具有不同的字节宽度。
2.  **字节排列顺序 (Byte Ordering / Endianness)**：
    *   在计算机中存储这些多字节数据时，可有不同的存放顺序。
    *   数据从低位到高位可以按从左到右排列，也可以按从右到左排列。
    *   为避免歧义，使用**最低有效位 (LSB - Least Significant Bit)** 和**最高有效位 (MSB - Most Significant Bit)** 来分别表示数的最低位和最高位。
    *   对于带符号数，最高位是符号位，所以 MSB 就是符号位。
    *   **示例**：数“5”在 32 位机器上用 `int` 类型表示时的 0/1 序列为 `00000000 00000000 00000000 00000101`。
        *   最左边的 '0' 是符号位 (MSB=0)。
        *   最右边的 '1' 是数的最低有效位 (LSB=1)。
3.  **字节编址 (Byte Addressing)**：现代计算机基本上都采用字节编址方式，即对存储空间的存储单元进行编号时，每个地址编号中存放一个字节。
4.  **字节排列顺序问题**：对于由多个字节组成的数据类型（如 `int` 占 4 字节，`double` 占 8 字节），程序中对每个数据只给定一个地址。那么，这个地址对应的是这多个字节中的哪个字节的地址呢？这就是字节排列顺序问题。
5.  **两种排列方式 (图 2.5)**：
	  ![[image-121.png]]
    *   **大端模式 (Big-Endian)**：
        *   **规则**：将数据的**最高有效字节 (MSB - Most Significant Byte)** 存放在**低地址单元**中，将**最低有效字节 (LSB - Least Significant Byte)** 存放在**高地址单元**中。
        *   **数据的地址**：是 MSB 所在的地址。
        *   **采用机器**：IBM 360/370、Motorola 68k、MIPS、Sparc、HP PA 等。
    *   **小端模式 (Little-Endian)**：
        *   **规则**：将数据的**最高有效字节 (MSB)** 存放在**高地址单元**中，将**最低有效字节 (LSB)** 存放在**低地址单元**中。
        *   **数据的地址**：是 LSB 所在的地址。
        *   **采用机器**：Intel 80x86、DEC VAX 等。
6.  **可配置模式的处理器**：有些微处理器芯片（如 Alpha 和 Motorola 的 PowerPC）能够运行在任意一种模式，只需在芯片加电启动时选择确定采用大端还是小端模式即可。
7.  **系统间通信问题**：
    *   每个计算机系统内部的数据排列顺序都是一致的。
    *   但在排列顺序不同的系统之间进行数据通信时，需要进行顺序转换。
    *   网络应用程序员必须遵守字节顺序的有关规定，以确保发送方机器将它的内部表示格式转换为网络标准 (通常是大端)，而接收方机器则将网络标准转换为自己的内部表示格式。
8.  **文件格式与字节顺序**：像音频、视频和图像等文件格式或处理程序也都涉及到字节顺序问题。
    *   小端：GIF, PC Paintbrush, Microsoft RTF 等。
    *   大端：Adobe Photoshop, JPEG, MacPaint 等。
9.  **调试时的意义**：了解字节顺序有助于在调试底层机器级程序时，能够清楚每个数据的字节顺序，以便将一个机器数正确转换为真值。
    *   **示例 (小端机器的反汇编)**：
        `80483BD: 01 05 64 94 04 08 add %eax, 0x8049464`
        *   指令代码 `01 05 64 94 04 08` (6 字节) 按顺序存放在从地址 `80483BDH` 开始的连续内存单元中。
        *   指令的第二个操作数是一个立即数 `0x8049464`，其十六进制表示为 `08049464H`。
        *   在指令代码中，该立即数存放的字节序列为 `64H 94H 04H 08H` (从低地址到高地址)。
        *   这正好与操作数 `08 04 94 64` (从高字节到低字节) 的字节序列相反，说明该处理器采用的是**小端模式**。
10. **示例 C 程序分析 (表 2.10)**：`test_show_bytes` 函数在不同系统上运行，显示 `int` 和 `float` 型数据以及指针的十六进制字节表示。
     ![[image-122.png]]
    *   **问题 (1) 12345 的整数和浮点数表示**：
        *   32 位补码整数：`00000000 00000000 00110000 00111001B` (00003039H)
        *   32 位浮点数 (IEEE 754)：`0 10001100 10000000011100100000000B` (4640E400H)
    *   **问题 (2) 相同位序列**：
        *   整数 `12345` 和浮点数 `12345.0` 表示中相同的位序列是 `11000000111001` (粗体部分)。
        *   原因：对正数，原码和补码编码相同。`12345` 的有效数位是 `11000000111001`。
            *   在定点整数中，它位于低位数值部分。
            *   在浮点数尾数中 (IEEE 754，隐藏首位 1)，它位于高位部分（除去隐藏的 1）。
        *   对负数：其整数补码与浮点数尾数原码表示不同，不一定会有相同位序列。
    *   **问题 (3) Intel Pentium II 的字节序**：
        *   Linux 和 Windows NT (运行在 Intel Pentium II) 的存放方式与书写习惯顺序相反，故 Intel Pentium II 采用的是**小端方式**。
    *   **问题 (4) Sun 和 Alpha 间数据传送**：
        *   不能直接进行数据传送。因为它们采用了不同的存放方式：Sun 是大端方式，这里 Alpha 设置的是小端方式。
    *   **问题 (5) Alpha 上数据字节 30H 的地址**：
        *   `int` 型数据 `12345` (00003039H) 在 Alpha (小端) 上的指针 `&ival` 指向的是 LSB 字节 `39H` 的地址 (例如 `...FC80H`)。
        *   字节 `30H` 是次低有效字节，其地址应该是数据地址随后的那个地址，即 `...FC81H`