好的，这是关于“3.5 运算部件的组成”的学习笔记：

## 3.5 运算部件的组成

前面分别介绍了各种定点数和浮点数的运算方法。综合考虑这些运算方法后，可以发现所有的运算都主要依赖于 **加减操作** 和 **移位操作** 作为基础。

因此，一个或多个 **ALU (算术逻辑单元)** 作为核心，配合 **移位器** 和用于存放中间临时结果的 **若干寄存器**，在相应的 **控制逻辑** 的控制下，就可以实现各种运算。

通常所说的 **运算部件 (Execution Unit / Datapath)**，是指 ALU、移位器、存放临时数据的寄存器，以及用于数据选择的 **多路选择器 (Multiplexer)** 和实现数据传送的 **总线 (Bus)** 等构成的一个运算数据通路。

这种运算数据通路：
*   可以专门用一个 **运算器芯片** 来实现。
*   也可以用 **若干个运算器芯片级联** 起来构成一个更大的运算器。
*   当然，运算用的数据通路也可以和控制逻辑 **混合做在同一个CPU芯片里**。

现代计算机一般都将运算部件和控制逻辑做在同一个CPU中。而且为了实现多条指令流水线，一个CPU中通常会有多个运算部件。广义上说，用于执行一个特定功能的部件都可以看成是一个运算部件，例如：
*   执行定点加减运算的 ALU。
*   执行乘(除)运算的阵列乘(除)法器。
*   专门的存储访问部件等。

通常把这样一个特定功能的运算部件称为一个 **执行部件 (Execution Unit)** 或 **功能部件 (Functional Unit)**。

专门的运算器芯片或CPU芯片中的运算部件是计算机中数据通路的主要部分。因此，**数据通路** 和 **运算器** 在某些场合下属于同一个概念，不同教材中可能会有不同的说法。

需要注意的是，**定点运算** 和 **浮点运算** 通常不使用同一套运算部件，它们是相互分开的。

---

### *3.5.1 定点运算部件

定点运算部件用于实现无符号整数和带符号整数的各种运算。一套完整的定点运算部件，除了核心部件ALU外，还需要：

*   **通用寄存器组 (General Purpose Register Set)** 或 **累加器 (Accumulator)**：用于存放操作数和中间结果。
*   **多路选择器 (Multiplexer)**：用于选择送往ALU的操作数来源。
*   **状态/标志寄存器 (Status/Flag Register)**：存放运算结果的标志信息 (如零、溢出、进位、符号等)。
*   **移位器 (Shifter)**：执行各种移位操作。
*   **数据总线 (Data Bus)**：用于在各部件之间传送数据。

也就是说，如果要设计一个专门的定点运算器芯片，那么该芯片中需要包含上述部件。如果在CPU中用数据通路来实现定点运算，那么数据通路中也必须包含同样的这些部件。

**AM2901A 内部逻辑框图 (图3.31):**
AM2901A 是一个典型的4位定点运算器芯片（位片式结构，可以级联）。其主要组成部分和功能如下：

*   **核心 ALU (4位):**
    *   可以实现 A+B, A-B, B-A 三种算术运算。
    *   可以实现“与”、“或”、“非”等5种逻辑运算。
    *   功能由来自中央控制部件 (CCU) 对外部操作信号 `I0~I8` (指令操作码) 译码后送来的控制信号决定。
    *   **输入/输出信号：**
        *   `C_n`：进位输入。
        *   `C_{n+4}`：进位输出 (用于串行级联或作为最高位芯片的进位标志)。
        *   `P*/O`：组进位传递/溢出信号 (用于多级级联或作为最高位芯片的溢出标志)。
        *   `G*/N`：组进位生成/符号信号 (用于多级级联或作为最高位芯片的符号标志)。
*   **通用寄存器组 (GRS - General Register Set):**
    *   4位双口，包含16个寄存器。
    *   一个写口，两个读口 (A口和B口)。
    *   `A0~A3` 地址线指定从A口读出的寄存器。
    *   `B0~B3` 地址线指定写入或从B口读出的寄存器。
    *   A口和B口可以同时读出，分别通过锁存器 LA 和 LB 送到 MUX。
*   **多路选择器 (MUX):**
    *   用于选择送往ALU的A、B操作数。
    *   ALU的A输入端可能来自：GRS的A口 (`DA0~3`，存储器数据)。
    *   ALU的B输入端可能来自：GRS的B口，存储器数据 (`DB0~3`)，Q寄存器。
    *   MUX的控制信号来自CCU (由 `I0~I8` 译码)。
*   **Q寄存器 (乘商寄存器):**
    *   主要用于实现乘除运算。部分积或中间余数通常是双倍字长，需要两个单倍字长寄存器存放。Q寄存器常用于存放乘法中的乘数或除法中的商。
*   **移位寄存器：**
    *   ALU移位寄存器 (ALU Shifter) 和 Q移位寄存器 (Q Shifter)。
    *   ALU运算结果先送到ALU移位寄存器。
    *   然后和Q移位寄存器一起进行左移或右移操作。
    *   移位后，ALU移位器的内容送回ALU继续下次运算，Q移位器的内容送到Q寄存器。
*   **输出：**
    *   `Z` 输出端：ALU结果判“0”后输出“零”标志信息。
    *   `Y` 输入/输出端：可以在存储器和寄存器之间双向传送数据。
*   **控制信号：**
    *   外部操作信号 `I0~I8` 经过CCU译码后，控制MUX选择、ALU操作类型、移位器操作 (左移/右移/不移) 以及Y端数据传送方向。
*   **级联能力：**
    *   AM2901A芯片可以相互连接构成更长位数的定点运算器。
        *   例如，4个AM2901A串联可构成16位串行进位定点运算器。
        *   配合AM2902 (CLA部件)，4个AM2901A可构成16位两级先行进位定点运算器。
*   **用通用运算器实现乘除：**
    *   不需要额外硬件逻辑。通过外部操作信号控制芯片正确执行若干步骤即可。
    *   步骤示例 (R0存部分积高位/余数，Q存部分积低位/商，R1存被乘数/除数)：
        1.  预置操作数。
        2.  选择正确的ALU操作数 (R0送A口, R1送B口)。
        3.  控制ALU执行正确的加减操作。
        4.  选择正确的移位方式 (如一位乘法右移)。
    *   在时钟控制下，经过若干步骤完成。

**现状：**
目前，像AM2901A这样的专门运算器芯片主要用于特定场合（如教学、硬件实验平台）。通用计算机内部的定点运算部件通常是作为CPU中数据通路的一部分而存在的。根据指令执行的时钟周期数和执行方式（串行/流水线），会有不同的数据通路构建方式（单周期、多周期、流水线数据通路），这些将在CPU设计章节详细介绍。

---

### *3.5.2 浮点运算部件

20世纪80年代，由于集成度限制，浮点运算部件 (FPU - Floating-Point Unit) 和定点运算部件通常难以集成在同一微处理器芯片中。因此，早期的机器采用专门的浮点协处理器芯片来执行浮点运算（如Intel的8087配合8086/8088）。

随着集成电路技术的发展，自20世纪90年代以来，浮点运算部件可以直接集成在CPU芯片中。

虽然定点和浮点运算部件集成在同一CPU芯片内，但它们的 **逻辑是分开的**。也就是说，CPU中有专门的定点运算部件和专门的浮点运算部件。存放定点数的寄存器和存放浮点数的寄存器通常也是分开的。现在几乎所有的处理器都内置专门的浮点数寄存器和浮点运算单元。

回顾3.4节介绍的浮点数加减和乘除运算，可以发现：
*   **阶码运算：** 主要是移码的加减操作。
*   **尾数运算：** 主要是定点原码小数的加、减、乘、除操作。

由于阶码运算和尾数运算是分开进行的，因此，**阶码运算部件** 和 **尾数运算部件** 也是分开的。

**浮点数加减运算部件的逻辑结构示意图 (图3.32):**
(虚线表示控制信号，图中省略了对两个ALU的控制信号线)

*   **主要部件：**
    *   **小ALU：** 用于执行阶码相减（对阶）。
    *   **大ALU：** 用于执行尾数加减。
    *   **控制逻辑：** 协调各个步骤的操作。
    *   **多路选择器、移位器、舍入部件等。**
*   **操作步骤及控制：**
    1.  **第一步 (对阶)：** 控制逻辑控制小ALU实现阶码相减 (`Ex - Ey`)，得到阶差。阶差送回控制逻辑。
    2.  **第二步 (对阶执行)：** 控制逻辑根据阶差的符号和绝对值确定如何进行对阶。
        *   控制信号①：确定结果的阶码是 `Ex` 还是 `Ey`。
        *   控制信号②和③：确定是对 `Mx` 还是 `My` 进行右移。
        *   控制信号④：确定右移的位数。
    3.  **第三步 (尾数加减)：** 控制逻辑控制大ALU对对阶后的尾数进行加减，运算结果送回控制逻辑，用于产生进行规格化的控制信号。
    4.  **第四步 (规格化)：** 控制逻辑根据大ALU的运算结果进行规格化。
        *   控制信号⑤和⑥：确定是对大ALU的运算结果还是对舍入后的结果进行规格化。
        *   控制信号⑦：确定尾数是左移还是右移。
        *   控制信号⑧：确定阶码是增加还是减少。
        *   规格化后的结果送到舍入部件和控制逻辑。
    5.  **第五步 (舍入)：** 控制逻辑⑨根据规格化后的结果进行舍入，并将舍入结果再次送到控制逻辑，以确定舍入后是否还需要再次规格化。
*   **流水线操作：** 从上述执行过程来看，浮点运算可以用流水化的形式进行。目前CPU中的浮点运算大多采用流水线执行方式。只要对图3.32所示的逻辑结构稍作调整（例如在各级之间加入流水线寄存器），就可以实现流水线方式的浮点运算。

这个笔记总结了定点和浮点运算部件的组成和基本工作原理，强调了ALU、寄存器、移位器和控制逻辑在其中的核心作用，并简要介绍了典型芯片和浮点运算的流水线潜力。