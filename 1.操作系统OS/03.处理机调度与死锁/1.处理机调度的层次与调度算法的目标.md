**引言 (P1)**
*   **背景**: 在多道程序环境下，内存中同时存在多个进程，其数量通常多于处理机（CPU）数量。
*   **需求**: 系统需要通过特定算法，动态地将处理机分配给处于就绪状态的某个进程执行。
*   **执行者**: 处理机调度程序。
*   **重要性**: 处理机调度的性能直接影响大型系统的关键性能指标，如：
    *   系统吞吐量 (System Throughput)
    *   资源利用率 (Resource Utilization)
    *   作业周转时间 (Job Turnaround Time)
    *   响应的及时性 (Responsiveness)
*   **核心**: 处理机调度是操作系统 (OS) 中至关重要的组成部分。
*   **调度的实质**: 资源分配，特指对处理机资源的分配。
*   **调度算法**: 根据处理机分配策略所规定的处理机分配方法。
*   **多级调度**: 在多道批处理系统中，一个作业从提交到完成可能经历多级处理机调度。

---
#### 3.1.1 处理机调度的层次 (Levels of Processor Scheduling)

1.  **高级调度 (High-Level Scheduling)**
    *   **别称**: 长程调度 (Long-Term Scheduling) 或 作业调度 (Job Scheduling)。
    *   **调度对象**: 作业 (Jobs)。
    *   **主要功能**:
        *   根据某种算法，决定从外存上的后备队列 (backup queue) 中选择哪些作业调入内存。
        *   为选中的作业创建进程。
        *   分配必要的资源给这些新创建的进程。
        *   将这些进程放入就绪队列 (ready queue)。
    *   **主要应用场景**: 多道批处理系统。
    *   **不设置场景**: 分时系统和实时系统通常不设置高级调度。
    *   **运行频率**: 较低。作业调度通常在一批作业运行完毕并退出系统，需要重新调入一批作业时发生，周期可能长达几分钟一次。 (P2, 第一段末尾)
    *   **算法复杂度**: 由于运行频率低，允许其算法花费较多时间。 (P2, 第一段末尾)

2.  **低级调度 (Low-Level Scheduling)**
    *   **别称**: 进程调度 (Process Scheduling) 或 短程调度 (Short-Term Scheduling)。
    *   **调度对象**: 进程 (Processes) 或 内核级线程 (Kernel-level Threads)。
    *   **主要功能**:
        *   根据某种算法，决定就绪队列中的哪个进程应获得处理机。
        *   由分派程序 (dispatcher) 将处理机分配给被选中的进程。
    *   **核心地位**: 是最基本的一种调度。
    *   **应用场景**: 在多道批处理、分时和实时三种类型的OS中都必须配置。
    *   **运行频率**: 最高。在分时系统中，通常仅10~100ms便进行一次进程调度。 (P2, 第一段)
    *   **算法复杂度**: 为避免调度本身占用过多CPU时间，算法不宜太复杂。 (P2, 第一段)

3.  **中级调度 (Intermediate Scheduling)**
    *   **别称**: 内存调度 (Memory Scheduling)。
    *   **引入目的**: 提高内存利用率和系统吞吐量。
    *   **主要功能**:
        *   将那些暂时不能运行的进程（例如，因内存不足或等待某些条件）从内存调至外存等待。此时进程状态变为“就绪驻外存状态” (ready-suspended state) 或“挂起状态” (suspended state)。
        *   当这些进程已具备运行条件且内存稍有空闲时，由中级调度决定，将外存上具备运行条件的就绪进程再重新调入内存，并修改其状态为“就绪状态”，挂在就绪队列上等待。
    *   **与内存管理的关系**: 实际上是存储器管理中的“对换功能” (swapping function)，将在第四章介绍。
    *   **运行频率**: 介于高级调度和低级调度之间，因此称为“中程调度” (medium-term scheduling)。 (P2, 第一段末尾)

---
#### 3.1.2 处理机调度算法的目标 (Goals of Processor Scheduling Algorithms)

*   **一般原则**: 调度方式和算法的选择在很大程度上取决于操作系统的类型及其设计目标。批处理、分时、实时系统通常采用不同的调度方式和算法。

1.  **处理机调度算法的共同目标 (Common Goals of Processor Scheduling Algorithms)**
    *   **(1) 资源利用率 (Resource Utilization)**
        *   目标: 使系统中的处理机和其他所有资源尽可能保持忙碌状态。
        *   CPU利用率计算公式:
            `CPU 利用率 = CPU有效工作时间 / (CPU有效工作时间 + CPU空闲等待时间)`
    *   **(2) 公平性 (Fairness)**
        *   目标: 使诸进程都获得合理的CPU时间，不发生进程饥饿现象。
        *   相对性: 对相同类型的进程应获得相同的服务；对不同类型的进程（根据其紧急程度或重要性）则应提供不同的服务。
    *   **(3) 平衡性 (Balance)**
        *   目标: 使系统中的CPU和各种外部设备都能经常处于忙碌状态，尽可能保持系统资源使用的平衡性。
        *   背景: 系统中可能存在计算型作业 (CPU-bound) 和 I/O型作业 (I/O-bound)。
    *   **(4) 策略强制执行 (Policy Enforcement)**
        *   目标: 对所制订的策略（包括安全策略等），只要需要，就必须予以准确地执行，即使会造成某些工作的延迟也要执行。

2.  **批处理系统的目标 (Goals for Batch Systems)**
    *   **(1) 平均周转时间短 (Short Average Turnaround Time)**
        *   **周转时间 (Turnaround Time, T)**: 从作业被提交给系统开始，到作业完成为止的这段时间间隔。
        *   **包含四部分时间**:
            1.  作业在外存后备队列上等待(作业)调度的时间。
            2.  进程在就绪队列上等待进程调度的时间。
            3.  进程在CPU上执行的时间。
            4.  进程等待I/O操作完成的时间。
            *   注: 后三项在一个作业的处理过程中可能发生多次。
        *   **用户期望**: 自己的作业周转时间最短。
        *   **系统管理者期望**: 平均周转时间最短，以提高资源利用率并使多数用户满意。
        *   **平均周转时间 (T_avg)** 公式: `T_avg = (1/n) * Σ Tᵢ` (其中 Tᵢ 是第 i 个作业的周转时间, n 是作业总数)
        *   **带权周转时间 (Weighted Turnaround Time, W)**: `W = T / Tₛ` (Tₛ 是作业的服务时间/实际运行时间)
            *   目的: 更清晰地描述各进程在其周转时间中等待和执行时间的具体分配状况。
        *   **平均带权周转时间 (W_avg)** 公式: `W_avg = (1/n) * Σ (Tᵢ / Tₛᵢ)`
    *   **(2) 系统吞吐量高 (High System Throughput)**
        *   **吞吐量 (Throughput)**: 单位时间内系统所完成的作业数。
        *   影响因素: 与批处理作业的平均长度有关。为提高吞吐量，应尽量多选择短作业运行。
    *   **(3) 处理机利用率高 (High Processor Utilization)**
        *   重要性: 对于大、中型计算机，CPU价格昂贵，其利用率是衡量系统性能的重要指标。
        *   实现方式: 为提高处理机利用率，应尽量多选择计算量大的作业运行。
    *   **目标间的矛盾**: 上述要求之间存在一定矛盾（例如，短作业优先利于吞吐量和平均周转时间，但可能不利于长作业；计算型作业优先利于CPU利用率，但可能使I/O设备空闲）。

3.  **分时系统的目标 (Goals for Time-Sharing Systems)**
    *   **(1) 响应时间快 (Fast Response Time)**
        *   **响应时间 (Response Time)**: 从用户通过键盘提交一个请求开始，直到屏幕上显示出处理结果为止的一段时间间隔。
        *   **重要准则**: 选择分时系统中进程调度算法的重要准则。
        *   **包含三部分时间**:
            1.  请求信息从键盘输入开始，直至其传送到处理机的时间。
            2.  处理机对请求信息进行处理的时间。
            3.  将所形成的响应信息回送到终端显示器的时间。
    *   **(2) 均衡性 (Balance/Proportionality)**
        *   用户对响应时间要求不同: 对较复杂任务的响应时间允许较长，对较简单任务的响应时间则要短。
        *   目标: 系统响应时间的快慢应与用户所请求服务的复杂性相适应。

4.  **实时系统的目标 (Goals for Real-Time Systems)**
    *   **(1) 截止时间的保证 (Deadline Guarantee)**
        *   **截止时间 (Deadline)**: 某任务必须开始执行的最迟时间，或必须完成的最迟时间。
        *   **严格实时系统 (Hard Real-Time, HRT)**: 调度方式和算法必须能保证任务的截止时间要求，否则可能造成难以预料的后果。
        *   **软实时系统 (Soft Real-Time, SRT)**: 调度方式和算法也应基本上能保证任务的截止时间要求。
    *   **(2) 可预测性 (Predictability)**
        *   重要性: 在实时系统中显得非常重要。
        *   例子: 多媒体系统（电影、电视剧）应连续播放，提供了请求的可预测性。
        *   技术: 双缓冲技术，可实现第 i 帧的播放和第 i+1 帧的读取并行处理，提高实时性。