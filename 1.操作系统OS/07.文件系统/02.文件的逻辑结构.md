
---

**7.2 文件的逻辑结构 (File Logical Structure)**

**核心概念 (Core Concept):**  
用户所看到的文件组织形式，即文件由一系列逻辑记录组成。这是从用户视角出发的数据组织形式，独立于文件的物理存储特性。文件的逻辑结构决定了用户如何看待和处理文件中的数据，而物理结构则关心文件如何在外存上存储。这两种结构都会影响文件的检索速度。

**7.2.1 文件逻辑结构的类型 (Types of File Logical Structures)**

**基本要求 (Basic Requirements for Logical Structure):**

1. **提高检索速度 (High Retrieval Speed):** 快速找到所需的记录。
    
2. **方便修改 (Easy Modification):** 便于在文件中增加、删除、修改记录。
    
3. **降低存储费用 (Low Storage Cost):** 尽量减少文件占用的存储空间，不要求大片连续存储空间。
    

**分类方式 (Classification Methods):**

**1. 按文件是否有结构分类 (Classification by Structure):**  
* **a) 有结构文件 (Structured File) / 记录式文件 (Record-Oriented File):**  
		* 由一个或多个记录构成。  
		* 每个记录用于描述实体集中的一个实体，包含若干数据项。  
		* 记录长度 (Record Length):  
	* **定长记录 (Fixed-Length Records):**  
		* 文件中所有记录长度相同。  
		* 所有记录中的数据项具有相同的顺序和长度。  
		* 优点: 有效提高检索记录的速度和效率，方便文件处理和修改。  
		* 应用: 目前较常用，广泛用于数据处理。  
	* **变长记录 (Variable-Length Records):**  
		* 文件中各记录长度不相同。  
		* 原因:  
			1. 记录中包含的数据项数目不同 (如: 书的著作者、论文关键词)。  
			2. 数据项本身长度不定 (如: 病历记录中的病因、病史，科技情报中的摘要)。  
	* 处理: 处理前，每个记录的长度是可知的。  
	* 缺点: 检索速度慢，不便于文件处理和修改。  
	* 应用: 适合某些特定场合，广泛用于许多商业领域。  
* **b) 无结构文件 (Unstructured File) / 流式文件 (Stream-Oriented File):**  
	* 由字符流构成，文件长度以字节为单位。  
	* 访问方式: 利用读、写指针指出下一个要访问的字符。  
	* 可视为记录式文件的一个特例：一个记录仅有一个字节。  
	* 应用: 大量的源程序、可执行文件、库函数等。
---
**2. 按文件的组织方式分类 (Classification by Organization Method - for structured files):**  

| **a) 顺序文件 (Sequential File):** 一系列记录按某种顺序排列形成的文件，记录可以是定长或可变长。  <br>  <br> |
| ------------------------------------------------------------------------- |
| **b) 索引文件 (Indexed File):** 为可变长记录文件建立索引表，为每个记录设置表项，以加速检索。                |
| **c) 索引顺序文件 (Indexed Sequential File):** 顺序文件和索引文件结合的产物，为一组记录中的第一个记录建立索引。 |

---
**7.2.2 顺序文件 (Sequential File)**

**排列方式 (Arrangement Methods):**

1. **串结构 (Serial/Chronological Structure):**
    
    - 记录按存入时间的先后顺序排列。
        
    - 各记录之间的顺序与关键字无关。
        
    - 检索: 每次都必须从头开始，逐个记录查找。
        
    - 缺点: 检索费时。
        
2. **顺序结构 (Sequential/Keyed Structure):**
    
    - 由用户指定一个字段作为关键字 (任意类型，最简单是整数 0 到 N-1)。
        
    - 每个记录的关键字值在文件中具有唯一性。
        
    - 所有记录按关键字排序 (大小、字母顺序)。
        
    - 检索: 可利用有效查找算法 (折半查找、插值查找、跳步查找)。
        
    - 优点: 检索速度和效率较高。
        

**优缺点 (Advantages and Disadvantages):**

- **优点 (Advantages):**
    
    - 对记录进行批量存取时效率最高。
        
    - 对于顺序存储设备 (如磁带)，只有顺序文件能被存储并有效工作。
        
- **缺点 (Disadvantages):**
    
    - 交互应用中，查找/修改单个记录性能差 (尤其文件大时，如 10⁴ 记录，平均需查找 5x10³ 次)。
        
    - 可变长记录时，开销更大，限制了文件长度。
        
    - 增加或删除记录困难。
        
        - **解决方案 (Solution for add/delete):** 配置运行记录文件 (Log File) 或事务文件 (Transaction File)，记录增删改信息，定期与主文件合并，产生新的按关键字排序的文件。
            

**7.2.3 记录寻址 (Record Addressing)**

(如何找到记录的地址)

1. **隐式寻址方式 (Implicit Addressing):**
    
    - **定长记录:** 若已知当前记录逻辑地址，易确定下一记录地址。
        
        - 读指针 Rptr 指向下一个记录首地址，每读完一个记录: Rptr = Rptr + L (L 为记录长度)。
         
        - 写指针 Wptr 指向要写的记录首地址，每写完一个记录: Wptr = Wptr + L。
            
        - (参考图 7-3a)
        ![[定长文件记录.png]]![[Pasted image 20250531144144.png]]
    - **变长记录:** 类似定长，但每次需从当前读/写记录中读出其长度 Li。
        
        - 读/写完一个记录后: 指针 + Li。
            
        - (参考图 7-3b)
            ![[Pasted image 20250531144201.png]]
    - **问题 (Problem):** 访问指定记录 i，必须扫描或读取前面 0 到 i-1 个记录，访问速度较慢。
    ![[变长记录文件图-1.png]]
2. **显式寻址方式 (Explicit Addressing):**
    
    - **a) 通过文件中记录的位置 (By position in file):**
        
        - 每个记录用 0 到 N-1 的整数标识。
            
        - **定长记录:** 第 i 个记录相对于首记录的地址 A_i = i * L。获得地址时间短，可实现随机访问。
            
        - **变长记录:** 第 i 个记录的首地址 A_i = Σ(L_j) + 1 (其中 j 从 0 到 i-1，假定每个记录前用一字节指明长度)。直接存取方法低效，检索时间难接受。
            
    - **b) 利用关键字 (Using a keyword):**
        
        - 用户指定一个字段作关键字。
            
        - 系统从第一个记录开始，顺序比较每个记录的关键字，直到找到匹配记录。
            
        - **注意:** 商业领域中可变长度、基于关键字的记录很重要 (数据库系统支持)。OS 文件系统支持有限，文件目录是例外 (关键字是文件名，7.3节介绍)。
            

**7.2.4 索引文件 (Index File)**

1. **按关键字建立索引 (Index by Keyword):**
    
    - **目的:** 解决变长记录文件查找耗时长的问题。
        
    - **方法:** 为主文件中的每个记录在索引表中分别设置一个表项。
        
        - **索引表项内容:** 指向记录的指针 (记录在逻辑地址空间的首址) 和记录的长度 L。
            
        - **索引表特性:** 按关键字排序，本身是定长记录的顺序文件。
            
    - **效果:** 把对变长记录顺序文件的顺序检索转变为对定长记录索引文件的随机检索，加快记录检索速度，实现直接存取。
        
    - **检索过程:** 用户提供关键字 -> (折半)查找索引表 -> 找到对应表项 -> 用指针访问记录。
        
    - **更新:** 增删记录时，须修改索引表。
        
    - (参考图 7-4a)
        ![[Pasted image 20250531144233.png]]
2. **具有多个索引表的索引文件 (Index File with Multiple Index Tables):**
    
    - **目的:** 满足不同用户按不同属性/关键字检索同一条记录的需求。
        
    - **方法:** 为每种可能的检索条件的域 (属性或关键字) 都配置一张索引表。
        
        - 例如: 图书文件可按书号、书名、作者、出版时间等建立多个索引表。
            
    - (参考图 7-4b，展示了不同索引结构的概念)
        ![[Pasted image 20250531144239.png]]
3. **优缺点 (Advantages and Disadvantages):**
    
    - **优点 (Advantages):**
        
        - 将顺序查找文件改造成可随机查找的文件，极大提高文件查找速度。
            
        - 插入和删除记录非常方便。
            
        - 应用最广泛的文件形式之一。
            
    - **缺点 (Disadvantages):**
        
        - 除了主文件，还须配置索引表 (每个记录一个索引项)，增加了存储开销。
            

**7.2.5 索引顺序文件 (Index Sequential File)**

1. **特征 (Characteristics):**
    
    - 对顺序文件的一种改进。
        
    - 克服了变长记录顺序文件不能随机访问及不便于记录增删的缺点。
        
    - 保留了顺序文件的关键特征：记录按关键字顺序组织。
        
    - **新增特征:**
        
        - **文件索引表:** 实现对索引顺序文件的随机访问。
            
        - **溢出(overflow)文件:** 记录新增加、删除、修改的记录。
            
    - **本质:** 顺序文件和索引文件相结合的产物，能有效克服变长记录文件缺点，代价不算太大。
        
2. **一级索引顺序文件 (Single-Level Index Sequential File):**
    
    - 最简单的索引顺序文件。
        
    - **建立方法:**
        
        1. 将变长记录顺序文件中的所有记录分为若干个组 (如 50 个记录/组)。
            
        2. 为顺序文件建立一张索引表。
            
        3. 为每组中的第一个记录在索引表中建立一个索引项 (含该记录关键字和指向该记录的指针)。
            
    - (参考图 7-5)
        ![[Pasted image 20250531144258.png]]
    - **检索过程:**
        
        1. 利用用户提供的关键字和查找算法检索索引表，找到记录所在记录组的第一个记录的表项，得到其在主文件中的位置。
            
        2. 利用顺序查找法在主文件中查找该记录组，找到所要求的记录。
            
    - **效率:**
        
        - N 个记录的顺序文件，平均查找 N/2 个记录。
            
        - 索引顺序文件，若分为 m 组，每组 k 个记录 (N=m*k)，平均查找 m/2 + k/2。若 m=k=√N，则平均查找 √N 个记录。
            
        - 检索效率 S 比顺序文件约提高 √N / 2 倍。
            
        - 例: 10000 个记录，顺序文件平均查 5000 个，索引顺序文件平均查 100 个 (效率是顺序文件的 50 倍)。
            
3. **两级索引顺序文件 (Two-Level Index Sequential File):**
    
    - **背景:** 对于非常大的文件 (如 10⁶ 记录)，一级索引表本身可能依然很大，查找仍耗时 (如 10⁶ 记录，一级索引平均查 1000 次)。
        
    - **方法:** 为索引文件再建立一张索引表 (多级索引)。
        
        - 例: 10⁶ 记录文件，先建低级索引表 (每 100 个记录/组，低级索引表含 10⁴ 项)。
            
        - 再为低级索引表建高级索引表 (每 100 个低级索引项/组，高级索引表含 10² 项)。
            
    - **查找记录数:** 平均为 (3/2) * N^(1/3)。
        
        - 例: N=10⁶ (即 1 百万)。顺序文件平均 50 万次。一级索引顺序文件平均 1000 次。两级索引顺序文件平均 150 次。
            

**7.2.6 直接文件和哈希文件 (Direct File and Hash File)**

1. **直接文件 (Direct File):**
    
    - 根据给定的关键字直接获得指定记录的物理地址。
        
    - 关键字本身就决定了记录的物理地址 ("键值转换" - Key to address transformation)。
        
    - 关键在于用什么方法进行从记录值到物理地址的转换。
        
2. **哈希文件 (Hash File):**
    
    - 目前应用最为广泛的一种直接文件。
        
    - 利用 **Hash函数 (散列函数)** 将关键字转换为相应记录的地址。
        
    - **动态存储分配:** Hash 函数所求得的并非是相应记录的地址，而是指向某一 **目录表** 相应表目的指针 A = H(K)。
        
    - 该表目的内容指向相应记录所在的物理块。(参考图 7-6)
        ![[Pasted image 20250531144321.png]]
    - Hash 函数通常作为标准函数存于系统中，供存取文件时调用。
        

---



