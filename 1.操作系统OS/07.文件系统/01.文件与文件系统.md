
**核心概念:**  
由于内存的易失性和容量有限，现代计算机系统必须配置外存，将大量程序和数据以**文件**的形式存放在外存中。操作系统中的**文件管理功能**专门管理外存上的文件，提供文件的存取、共享和保护等手段，以方便用户、保证文件安全并提高资源利用率。

**7.1.1 数据项、记录和文件**
文件系统将数据组织成三个层级：数据项、记录和文件。
1. **数据项 (字段 - Field):**
    - 最低级的数据组织形式，描述对象某种属性的字符集，是可命名的最小逻辑数据单位。
    - **类型:**
        - **(1) 基本数据项:** 描述对象单一属性 (例: 学号、姓名、年龄)。
        - **(2) 组合数据项 (组项):** 由若干基本数据项组成 (例: 工资 = 基本工资 + 工龄工资 + 奖励工资)。
    - **属性:** 基本数据项除了**数据名**外，还应有**数据类型** (例: 整数、字符串、逻辑变量)。
    - **型 (Type):** 由数据项的名字和类型共同定义。
    - **值 (Value):** 表征实体在数据项上的具体数据 (例: 学号/30211)。
2. **记录 (Record):**
    - 一组相关数据项的集合，用于描述一个对象在某方面的属性。
    - 一个记录通常包含描述特定对象实例的所有信息 (例: 一个学生的完整信息记录)。
    - **关键字 (Key):** 用于唯一标识一个记录的一个或一组数据项。
3. **文件 (File):**
    - 由创建者定义的、具有文件名的一组相关元素的集合。    
    - **类型:**
        - **有结构文件 (记录式文件):** 由若干相关记录组成。
        - **无结构文件 (流式文件):** 被看作一个字符流。
    - 文件是文件系统中最大的数据单位，描述一个对象集 (例: 一个班的学生记录集合成一个文件)。
    - **文件属性 (元数据):**
        - **(1) 文件类型:** 源文件、目标文件、可执行文件等。
        - **(2) 文件长度:** 当前长度 (字节、字或块)，也可能是最大允许长度。
        - **(3) 文件的物理位置:** 指示文件所在的设备及在设备中的地址指针。
        - **(4) 文件的建立时间:** 最后一次的修改时间等。
    - 层次关系图 (图7-1): 文件 -> 记录 -> 数据项
        ![[Pasted image 20250531144036.png]]

**7.1.2 文件名和类型**
1. **文件名和扩展名:**
    - **(1) 文件名:**
        - 不同系统规定不同，老系统有长度限制 (MS-DOS 8字符，老UNIX 14字符)。
        - 特殊字符 (如空格) 通常禁用。
        - 现代OS (如NTFS) 支持长文件名。
        - 大小写敏感性: UNIX/Linux区分，MS-DOS/Win95不区分。
    - **(2) 扩展名 (后缀名):**
        - 文件名后附加字符，指示文件类型 (例: myfile.txt 中 txt 是扩展名)。
        - 用圆点 "." 与文件名分开。
        - 长度一般1-4字符。
2. **文件类型 (分类方法):**
    - **1) 按用途分类:**
        - **(1) 系统文件:** 系统软件构成，用户可调用但通常不许读改，或不直接对用户开放。
        - **(2) 用户文件:** 用户源代码、目标文件、可执行文件、数据等。
        - **(3) 库文件:** 标准子例程、常用例程等，用户可调用但不许修改。
    - **2) 按文件中数据的形式分类:**
        - **(1) 源文件:** 源程序和数据构成，通常是ASCII码或汉字。
        - **(2) 目标文件:** 源程序编译后、链接前的代码 (.obj)。
        - **(3) 可执行文件:** 目标代码链接后形成的文件 (.exe)。            
    - **3) 按存取控制属性分类:**
        - **(1) 只执行文件:** 核准用户可调用执行，不许读写。
        - **(2) 只读文件:** 文件主及核准用户可读，不许写。
        - **(3) 读写文件:** 文件主及核准用户可读写。
    - **4) 按组织形式和处理方式分类:**
        - **(1) 普通文件:** ASCII码或二进制码字符文件 (源程序、数据文件、OS代码、实用程序)。
        - **(2) 目录文件:** 由文件目录组成，用于检索其下属文件信息。
        - **(3) 特殊文件:** 系统中的各类I/O设备，按文件方式提供给用户使用。

**7.1.3 文件系统的层次结构 (图7-2)**
 ![[Pasted image 20250531144059.png]]
模型分为三层：最底层是对象及其属性，中间层是对对象进行操纵和管理的软件集合，最高层是文件系统提供给用户的接口。
1. **对象及其属性 (管理对象):**
    - **(1) 文件:** 直接管理对象。
    - **(2) 目录:** 方便用户存取和检索文件，包含文件名、属性、物理地址等。
    - **(3) 磁盘(磁带)存储空间:** 文件和目录占用的空间。
2. **对对象操纵和管理的软件集合 (核心):**
    - 功能：存储空间管理、目录管理、逻辑地址到物理地址转换、文件读写管理、共享与保护。
    - **软件层次:**
        - **(1) I/O 控制层 (设备驱动程序层):** 最低层，如磁盘驱动程序。
        - **(2) 基本文件系统层:** 处理内存与磁盘间数据块交换。
        - **(3) 基本 I/O 管理程序:** 完成磁盘I/O事务 (逻辑块号转物理块号、空闲盘块管理、I/O缓冲指定)。
        - **(4) 逻辑文件系统:** 处理与记录和文件相关的操作 (符号文件名访问、文件和记录保护)。
3. **文件系统的接口 (用户交互):**
    - **(1) 命令接口:** 用户与文件系统直接交互 (键盘命令)。
    - **(2) 程序接口:** 用户程序通过系统调用获取文件系统服务 (例: Creat, Open)。

**7.1.4 文件操作**

用户通过文件系统提供的系统调用对文件进行操作。
1. **最基本的文件操作:**
    - **(1) 创建文件 (Creat):** 分配外存空间，建立目录项 (记录文件名、地址等)。
    - **(2) 删除文件 (Delete):** 找到目录项，使其空闲，回收存储空间。
    - **(3) 读文件 (Read):** 根据文件名查找目录，获取文件位置，利用读指针读取。
    - **(4) 写文件 (Write):** 根据文件名查找目录，利用写指针写入。
    - **(5) 设置文件的读/写位置:** 允许随机存取，改变下次读写操作的起始点。
2. **文件的“打开”(Open)和“关闭”(Close)操作:**
    - **打开 (Open):**
        - 目的: 避免多次重复检索目录。
        - 过程: 系统将指名文件的属性 (包括物理位置) 从外存拷贝到内存的“打开文件表”的表目中，返回该表目的编号(索引号)给用户。
        - 效果: 在用户和指定文件间建立连接。
    - **关闭 (Close):**
        - 目的: 用户不再需要操作该文件时，断开连接。
        - 过程: OS将文件从打开文件表的表目中删除。
3. **其它文件操作:**
    - **文件属性操作:** 修改文件名、拥有者、访问权限等。
    - **文件状态查询:** 文件类型、大小、拥有者等。
    - **目录操作:** 创建目录、删除目录、改变当前目录等。
    - **文件共享操作。**


---

